# Version 4: 그리드 크기 확대 (0.9m)

## 📋 개요
v3의 심각한 오버피팅 문제를 해결하기 위해 그리드 크기를 0.45m에서 0.9m로 확대

## ❌ v3의 문제점
```
Train Accuracy:  35.04%
Val Accuracy:    2.37%
Test Accuracy:   1.92%
```

**원인 분석:**
- 클래스 수 과다 (2,152개)
- 84K 샘플로는 2,152개 클래스 학습 불가능
- 클래스당 평균 39.2개 샘플 → 여전히 부족
- Train/Val 사이 클래스 겹침 부족
- 심각한 오버피팅 발생

## 🔧 v4 핵심 변경점

### 그리드 크기 확대
- **v3**: 0.45m × 0.45m 그리드
- **v4**: 0.9m × 0.9m 그리드 (2배 확대)

### 예상 효과
- **클래스 수**: 2,152개 → 약 538개 (약 1/4로 감소)
- **클래스당 평균 샘플**: 39.2개 → 약 156개 (약 4배 증가!)
- **학습 안정성**: 대폭 개선 예상
- **일반화 성능**: Val/Test 정확도 향상 기대

## 📊 전처리 전략 (v3와 동일)
- **데이터 소스**: 마커 사이 모든 샘플 활용
- **Window 크기**: 100 샘플 (2초)
- **Stride**: 5 샘플
- **데이터 증강**: 30% 샘플에 센서 노이즈
  - 지자기 노이즈: Gaussian(μ=0, σ=0.8μT)
  - 방향 노이즈: Gaussian(μ=0, σ=1.5°)
- **클래스 필터링**: 10개 미만 샘플 클래스 제거

## 🔍 입력/출력 사양
- **입력 shape**: (batch, 100, 6)
  - 100 timesteps (2초)
  - 6 features: [MagX, MagY, MagZ, Pitch, Roll, Yaw]
- **출력**: ~538개 클래스 (0.9m 그리드 셀 ID)

## 🎯 목표
- Train Accuracy: 60% 이상
- Val/Test Accuracy: Train 대비 70% 이상 유지 (오버피팅 최소화)
- 예: Train 70%, Val 50%, Test 48% → 성공!

## 📈 버전 비교

| 항목 | v3 | v4 | 개선 |
|------|----|----|------|
| 그리드 크기 | 0.45m | 0.9m | 2배 |
| 예상 클래스 수 | 2,152개 | ~538개 | 1/4 |
| 클래스당 평균 | 39.2개 | ~156개 | 4배 |
| Train Acc | 35% | ? | 기대 |
| Val Acc | 2.4% | ? | 기대 |
| Test Acc | 1.9% | ? | 기대 |
| 오버피팅 | 심각 ❌ | 개선 기대 ✅ | - |

## 📂 파일
- `preprocessing_v4.py`: 전처리 스크립트 (GRID_SIZE=0.9)
- `processed_data_v4/`: 생성된 데이터셋
- `train_lstm.py`: LSTM 모델 학습 스크립트 (v3와 동일)

## 🚀 LSTM 모델 (v3와 동일)
- **구조**: 4층 LSTM (128 → 256 → 256 → 128)
- **총 파라미터**: 약 1.4M개
- **Batch size**: 128
- **Epochs**: 100 (Early Stopping: patience=15)

## 💡 추가 개선 방향 (v4가 실패하면)
1. **그리드 더 확대**: 1.35m (3배), 1.8m (4배)
2. **회귀 문제로 전환**: (x, y) 좌표 직접 예측 (MSE loss)
3. **계층적 분류**: Zone → Sub-zone 2단계
4. **모델 단순화**: LSTM 레이어 축소 (오버피팅 방지)

## 🔄 다음 단계
1. preprocessing_v4.py 실행
2. 클래스 수 확인 (예상: ~538개)
3. LSTM 학습
4. 성능 평가 및 v3 대비 비교

---
**기대 효과**: 클래스당 샘플이 4배 증가하여 오버피팅이 크게 완화되고, Val/Test 정확도가 Train에 근접할 것으로 예상
