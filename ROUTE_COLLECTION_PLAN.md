# Route 수집 계획 - 1.5m @ 90% 달성을 위한 데이터 보강

## 핵심 결론
- **현재 부족 샘플: 6,976개**
- **부족한 위치: 458개 (grid, direction) 조합**
- **필요한 route: 32개** (모두 신규 수집 필요)

## 문제 정의

### 방향 반영 후 샘플 분포
```
총 조합: 1,379개 (grid, direction)
평균 샘플: 7.9개
중앙값: 4개

샘플 < 5개: 780개 (56.6%) ← 학습 불가능
샘플 < 10개: 1,049개 (76.1%) ← 매우 약한 학습
샘플 < 15개: 1,184개 (85.9%) ← 1.5m 정확도 어려움
```

### 목표
- 모든 (grid, direction) 조합이 **최소 15개 이상** 샘플 확보
- 이상적으로는 **20개 이상** 권장
- 총 6,976개 추가 샘플 필요

---

## 수집 Route 목록 (우선순위 순)

### Top 10 Priority Routes

| 순위 | Route | 현재 상태 | 필요 샘플 | 방향별 상세 |
|------|-------|----------|-----------|------------|
| 1 | **13 → 14** | 미수집 | **197개** | 서(24), 북서(28), 북(36), 남(20), 남동(19), 동(23), 남서(25), 북동(22) |
| 2 | **14 → 13** | 미수집 | **194개** | 북동(41), 남동(14), 동(18), 남서(25), 남(21), 서(22), 북(28), 북서(25) |
| 3 | **14 → 15** | 미수집 | **142개** | 서(23), 남서(16), 남(17), 북(19), 남동(20), 북동(19), 동(14), 북서(14) |
| 4 | **8 → 7** | 미수집 | **135개** | 남서(33), 남(21), 북(22), 서(17), 북서(15), 북동(11), 남동(10), 동(6) |
| 5 | **10 → 9** | 미수집 | **129개** | 남(17), 남동(18), 남서(17), 북서(16), 서(16), 동(16), 북(15), 북동(14) |
| 6 | **7 → 8** | 미수집 | **123개** | 동(25), 북동(17), 북(18), 북서(16), 남(14), 남동(12), 서(12), 남서(9) |
| 7 | **9 → 10** | 미수집 | **116개** | 북(16), 북동(15), 동(16), 남동(15), 남(13), 남서(14), 서(14), 북서(13) |
| 8 | **15 → 14** | 미수집 | **113개** | 동(17), 남동(16), 남(15), 남서(13), 서(13), 북서(13), 북(13), 북동(13) |
| 9 | **11 → 10** | 미수집 | **110개** | 남(16), 남동(15), 동(14), 북동(14), 북(13), 북서(13), 서(13), 남서(12) |
| 10 | **12 → 11** | 미수집 | **108개** | 남서(15), 남(14), 남동(14), 동(14), 북동(14), 북(13), 북서(12), 서(12) |

### Routes 11-20

| 순위 | Route | 현재 상태 | 필요 샘플 | 주요 방향 |
|------|-------|----------|-----------|----------|
| 11 | **10 → 11** | 미수집 | **105개** | 북(17), 북동(15), 동(13), 남동(13), 남(12), 남서(12), 서(12), 북서(11) |
| 12 | **11 → 12** | 미수집 | **102개** | 북동(15), 북(14), 북서(13), 서(13), 남서(13), 남(12), 남동(11), 동(11) |
| 13 | **12 → 13** | 미수집 | **99개** | 북동(14), 북(13), 북서(13), 서(13), 남서(12), 남(12), 남동(11), 동(11) |
| 14 | **9 → 8** | 미수집 | **95개** | 서(14), 남서(13), 남(12), 남동(12), 동(12), 북동(11), 북(11), 북서(10) |
| 15 | **13 → 12** | 미수집 | **92개** | 남서(13), 남(12), 남동(12), 동(12), 북동(11), 북(11), 북서(11), 서(10) |
| 16 | **15 → 16** | 미수집 | **88개** | 남(13), 남동(12), 동(11), 북동(11), 북(11), 북서(10), 서(10), 남서(10) |
| 17 | **16 → 15** | 미수집 | **85개** | 북(12), 북동(11), 동(11), 남동(11), 남(10), 남서(10), 서(10), 북서(10) |
| 18 | **8 → 9** | 미수집 | **81개** | 동(12), 북동(11), 북(10), 북서(10), 서(10), 남서(9), 남(10), 남동(9) |
| 19 | **7 → 6** | 미수집 | **78개** | 남서(11), 남(10), 남동(10), 동(10), 북동(10), 북(9), 북서(9), 서(9) |
| 20 | **6 → 7** | 미수집 | **74개** | 북동(10), 북(10), 북서(9), 서(9), 남서(9), 남(9), 남동(9), 동(9) |

### Routes 21-32 (완성도 높이기)

| 순위 | Route | 필요 샘플 | 순위 | Route | 필요 샘플 |
|------|-------|----------|------|-------|----------|
| 21 | **16 → 17** | 71개 | 27 | **4 → 5** | 56개 |
| 22 | **17 → 16** | 68개 | 28 | **3 → 4** | 52개 |
| 23 | **6 → 5** | 64개 | 29 | **4 → 3** | 49개 |
| 24 | **5 → 6** | 61개 | 30 | **17 → 18** | 45개 |
| 25 | **5 → 4** | 59개 | 31 | **18 → 17** | 42개 |
| 26 | **1 → 2** | 58개 | 32 | **2 → 1** | 39개 |

---

## 수집 가이드

### 1. Route당 수집 방법

각 route는 **양방향 모두 수집**해야 합니다:
- 예: 13→14와 14→13은 **별개의 route**
- 같은 위치(x,y)라도 방향에 따라 지자기 값이 다름

### 2. 수집 시 주의사항

**방향 분포 균등화:**
- 각 route를 여러 번 왕복하면서 수집
- 8방향(동, 북동, 북, 북서, 서, 남서, 남, 남동)이 골고루 포함되도록
- 회전하거나 돌아서 걷기 등으로 방향 변화 유도

**예시: 13→14 route (197개 필요)**
```
1차 수집: 13→14 직진 (동쪽 방향 중심, ~25개)
2차 수집: 13→14 좌회전 포함 (북동/북 방향, ~35개)
3차 수집: 13→14 우회전 포함 (남동/남 방향, ~30개)
4차 수집: 13→14 역방향 보강 (서/남서/북서 방향, ~35개)
... 총 8차 수집
```

### 3. 데이터 검증

수집 후 즉시 확인:
```bash
python analyze_data.py
```

확인 항목:
- [ ] 해당 route의 (grid, direction) 조합 샘플 수 증가
- [ ] 모든 방향이 최소 15개 이상 확보
- [ ] 전체 분포도에서 빈 구간 감소

---

## 예상 수집 시간

### 수집 효율 추정
- Route당 평균 필요 샘플: 218개 (6,976 / 32)
- Window stride: 50 샘플 = 1초
- 1분 수집 시 약 60개 샘플 생성
- Route당 평균 소요 시간: **약 3-4분**

### 총 소요 시간
```
32 routes × 4분 = 128분 ≈ 2시간 10분
여유분 포함: 약 3시간
```

**현실적 수집 계획:**
- Day 1: Top 10 routes (약 1시간)
- Day 2: Routes 11-20 (약 50분)
- Day 3: Routes 21-32 (약 40분)
- Day 4: 검증 및 보강 (약 30분)

---

## 수집 순서 추천

### Phase 1: 핵심 구간 (Top 10)
가장 샘플이 부족한 구간부터 우선 수집
→ **1,322개 샘플 확보** (18.9%)

### Phase 2: 중요 구간 (11-20)
중간 정도 부족한 구간 수집
→ **추가 885개 샘플 확보** (누적 31.6%)

### Phase 3: 완성도 (21-32)
전체 균형을 위한 마무리 수집
→ **추가 658개 샘플 확보** (누적 41.1%)

### Phase 4: 검증 및 추가 수집
- 분석 스크립트 실행
- 여전히 부족한 (grid, direction) 조합 확인
- 해당 route 추가 수집

---

## 현재 vs 목표

### 현재 상태
```
총 샘플: 10,802개
평균 샘플/조합: 7.9개
샘플 < 15개: 1,184개 (85.9%)
예상 성능: 3.5~4.0m @ 90%
```

### 목표 상태 (수집 후)
```
총 샘플: 17,778개 (+6,976)
평균 샘플/조합: 12.9개
샘플 < 15개: 약 600개 (43%)
예상 성능: 2.0~2.5m @ 90%
```

### 이상적 상태 (추가 보강 후)
```
총 샘플: 25,000개+
평균 샘플/조합: 18개+
샘플 < 15개: < 20%
예상 성능: 1.5~2.0m @ 90% ✅
```

---

## 체크리스트

수집 전:
- [ ] 센서 캘리브레이션 완료
- [ ] 배터리 충전 확인
- [ ] nodes_final.csv 최신 버전 확인
- [ ] Highlighted marker 정확도 확인

수집 중:
- [ ] Top 10 routes 완료 (197+194+142+...개)
- [ ] Routes 11-20 완료
- [ ] Routes 21-32 완료
- [ ] 각 route마다 8방향 균등 분포 확인

수집 후:
- [ ] `python analyze_data.py` 실행
- [ ] 샘플 < 5개 조합이 < 10% 확인
- [ ] 전체 평균 샘플/조합 > 12개 확인
- [ ] 전처리 및 학습 재실행

---

## 참고사항

### 왜 15-20개가 필요한가?
```
샘플 1-5개:   학습 불가능 (overfitting 100%)
샘플 5-10개:  매우 약한 학습 (일반화 어려움)
샘플 10-15개: 보통 학습 (2.5-3.0m 가능)
샘플 15-20개: 양호한 학습 (1.5-2.0m 가능) ✅
샘플 20개+:   좋은 학습 (1.5m 이하 가능) ✅✅
```

### 대안 (데이터 수집 불가 시)
1. **방향 무시 학습**: Yaw를 feature로 포함, 방향 구분 안 함
   - 예상 성능: 2.5~3.0m @ 90%
   - 샘플 충분 (평균 22.1개/grid)

2. **목표 하향 조정**: 현실적 목표 재설정
   - 2.5~3.0m @ 90% 로 목표 변경
   - 현재 데이터로 충분

3. **Augmentation 강화**: 더 공격적인 데이터 증강
   - 효과: 제한적 (+10~15% 성능)
   - 근본적 해결 아님
